# 兵智世界前后端连接使用说明

## 系统概述

现在您的项目已经实现了完整的前后端连接，包括：
- 用户注册功能
- 用户登录功能  
- 个人中心信息展示和修改功能
- 数据实时存储到SQLite数据库

## 功能特性

### 1. 用户注册 (register.html)
- **功能**：创建新用户账号
- **数据验证**：
  - 用户名：3-30个字符，只能包含字母和数字
  - 密码：至少6个字符
  - 邮箱：有效的邮箱格式
  - 密码确认：两次输入必须一致
- **数据存储**：用户信息加密存储到SQLite数据库
- **自动跳转**：注册成功后自动跳转到个人中心

### 2. 用户登录 (login.html)
- **功能**：用户身份验证
- **支持方式**：用户名或邮箱登录
- **安全性**：JWT令牌认证
- **自动跳转**：登录成功后跳转到个人中心

### 3. 个人中心 (profile.html)
- **信息展示**：
  - 用户名
  - 电子邮箱
  - 手机号码
  - 个人简介
- **信息修改**：
  - 实时更新到数据库
  - 表单验证
  - 成功提示
- **安全保护**：
  - 登录状态检查
  - 令牌过期自动跳转
  - 退出登录功能

## 数据库结构

### 用户表 (users)
```sql
CREATE TABLE users (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  username TEXT UNIQUE NOT NULL,        -- 用户名
  email TEXT UNIQUE NOT NULL,           -- 邮箱
  password_hash TEXT NOT NULL,          -- 加密密码
  name TEXT,                           -- 显示名称
  phone TEXT,                          -- 手机号码
  bio TEXT,                            -- 个人简介
  avatar TEXT,                         -- 头像
  role TEXT DEFAULT 'user',            -- 用户角色
  status TEXT DEFAULT 'active',        -- 账户状态
  preferences TEXT DEFAULT '{}',       -- 用户偏好设置
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  last_login DATETIME                  -- 最后登录时间
);
```

## API接口

### 认证相关接口
- `POST /api/auth/register` - 用户注册
- `POST /api/auth/login` - 用户登录
- `GET /api/auth/profile` - 获取用户信息
- `PUT /api/auth/profile` - 更新用户资料

### 请求示例

#### 用户注册
```javascript
POST /api/auth/register
Content-Type: application/json

{
  "username": "testuser",
  "email": "test@example.com", 
  "password": "123456",
  "name": "测试用户"
}
```

#### 用户登录
```javascript
POST /api/auth/login
Content-Type: application/json

{
  "username": "testuser",
  "password": "123456"
}
```

#### 更新用户资料
```javascript
PUT /api/auth/profile
Content-Type: application/json
Authorization: Bearer <JWT_TOKEN>

{
  "name": "新名称",
  "phone": "13800138000",
  "bio": "个人简介"
}
```

## 使用流程

### 1. 启动后端服务
```bash
cd backend
npm run dev
```
服务将在 http://localhost:3001 启动

### 2. 访问前端页面
- 注册页面：`register.html`
- 登录页面：`login.html`
- 个人中心：`profile.html`

### 3. 完整使用流程
1. 打开 `register.html` 注册新账号
2. 注册成功后自动跳转到个人中心
3. 在个人中心查看和修改个人信息
4. 信息修改后实时保存到数据库
5. 可以退出登录，然后通过 `login.html` 重新登录

## 技术特性

### 前端技术
- 原生JavaScript
- Fetch API进行HTTP请求
- LocalStorage存储用户状态
- 表单验证和错误处理

### 后端技术
- Node.js + Express.js
- SQLite数据库
- JWT身份认证
- bcrypt密码加密
- 数据验证中间件

### 安全特性
- 密码bcrypt加密存储
- JWT令牌认证
- 输入数据验证
- CORS跨域配置
- 请求频率限制

## 数据流程

### 注册流程
1. 用户填写注册表单
2. 前端验证数据格式
3. 发送POST请求到 `/api/auth/register`
4. 后端验证数据并检查用户是否存在
5. 密码加密后存储到数据库
6. 返回JWT令牌
7. 前端保存令牌并跳转

### 登录流程
1. 用户输入用户名和密码
2. 发送POST请求到 `/api/auth/login`
3. 后端验证用户名和密码
4. 返回JWT令牌和用户信息
5. 前端保存令牌并跳转到个人中心

### 个人中心流程
1. 页面加载时检查JWT令牌
2. 发送GET请求到 `/api/auth/profile` 获取用户信息
3. 显示用户信息到表单
4. 用户修改信息后提交
5. 发送PUT请求到 `/api/auth/profile` 更新数据
6. 数据库实时更新

## 故障排除

### 常见问题
1. **CORS错误**：确保后端服务正在运行
2. **登录失败**：检查用户名和密码是否正确
3. **令牌过期**：重新登录获取新令牌
4. **数据库错误**：检查SQLite数据库文件权限

### 调试方法
1. 打开浏览器开发者工具查看网络请求
2. 查看后端日志文件 `backend/logs/app.log`
3. 检查LocalStorage中的用户数据

## 扩展功能

您可以基于现有架构继续扩展：
- 头像上传功能
- 密码修改功能
- 邮箱验证功能
- 用户权限管理
- 社交登录集成

现在您的前后端系统已经完全连接，可以实现用户注册、登录和个人信息管理的完整功能！